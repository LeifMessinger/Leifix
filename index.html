<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>PrePostInfix Solver</title>
		<meta name="description" content="PrePostInfix Solver">
		<meta name="author" content="Leif Messinger">

		<!--<link href="style.css" rel="stylesheet" type="text/css"/> Shit don't work in local html-->
		<style>
			.equation.background{
				display: flex;
				margin-top: 3vh;
				margin-bottom: 0vh;
				margin-left: 3vw;
				margin-right: 3vw;
			}
			.equation.text{
				flex: 1 1;
			}
			.display.background{
				display: flex;
				margin-top: 0vh;
				margin-left: auto;
				margin-right: auto;
				width: 90vw;
				height: 75vh;
				background-color: black;
				overflow: scroll;
			}
			.display.text{
				flex: 1 1;
				margin: 10px;
				color: rgb(0,255,0);
				font-family: "Courier New", monospace;
			}
		</style>

	</head>

	<body>
		<div class="equation background">
			<input id="equation" class="equation text" type="text" autocomplete="off" placeholder="7 5 6 - *" pattern="[\+\-\*\/\d\s]+"></input>
		</div>
		<br/>
		<div class="display background">
			<bruh class="display text">
				bruh
			</bruh>
		</div>
		<!--<script src="script.js"></script> Still don't work-->
		<script>
			const equation = document.getElementById("equation");	//equation.value
			const display = document.querySelector(".display.text");	//display.textContent
			
			let operatorDictionary = {
				"+": function(a,b){
					return a + b;
				},
				"-": function(a,b){
					return a - b;
				},
				"*": function(a,b){
					return a * b;
				},
				"/": function(a,b){
					return a / b;
				}
			}
			function print(str){	//Might not be a perfect html print, but it works
				let line = document.createElement("line");
				line.textContent = str;
				display.appendChild(line);
			}
			function newLine(){
				let lineBreak = document.createElement("br");
				display.appendChild(lineBreak);
			}
			function println(str){
				print(str);
				newLine();
			}
			function run(e){
				display.innerHTML = "";	//Clear display
				println(equation.value);
				println("Word number. Current word\tOperator stack\tVariable queue-stack-list");
				let words = equation.value.split(" ").filter(word => word!="");
				let variables = [];
				let operators = [];
				function printStats(){
					//HTML text content can't tab, so just live with it
					//And no I'm not using a textarea. I'm starting to hold a little grudge against them.
					println("\t" + JSON.stringify(operators) + "\t" + JSON.stringify(variables));
				}
				function operate(operator,a,b){	//Given 3 strings
					println("\"" + operator + "\" has what it needs, the " + a + " and the " + b);
					println("It takes those off the queue and it opearates");
					const ret = operatorDictionary[operator](parseFloat(a),parseFloat(b));
					println("It returns " + ret + " that gets unshifted back onto the queue");
					return ret;
				}
				for(let i = 0; i < words.length; i++){
					const word = words[i];
					print(i + ". '" + word + "'");
					if(!isNaN(word)){	// || word[0] == '"'){
						//word is a variable
						variables.push(word);	//There's more than one variable
						printStats();
						if(operators.length >= 1){	//There's at least one operator
							const operator = operators[0];
							if(variables.length >= 2){
								//That operator has what it needs
								const ret = operate(operators.pop(),variables.shift(),variables.shift());
								variables.unshift(ret);
								printStats();
							}else{
								//That operator doesn't have what it needs
								println("\"" + operator + "\" doesn't have what it needs");
							}
						}else{
							println("\tThere are no operators to operate with");
						}
					}else{
						//word is an operator
						console.assert(operatorDictionary[word] != undefined);
						operators.push(word);
						printStats();
						const operator = word;
						if(variables.length >= 2){
							//That operator has what it needs
							let removedVars = variables.splice(variables.length-2,2);
							const ret = operate(operators.pop(),removedVars.shift(),removedVars.shift());
							//It pops and pushes because the operator is late to the party and needs the the last things added
							variables.push(ret);
							printStats();
						}else{
							//That operator doesn't have what it needs
							println("\"" + operator + "\" doesn't have what it needs");
						}
					}
					newLine();
				}
			}
			equation.onchange = run;
		</script>
	</body>
</html>
